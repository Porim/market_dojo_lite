<div class="max-w-7xl mx-auto">
  <div class="mb-6">
    <%= link_to "← Back to Reports", reports_path, class: "text-blue-600 hover:text-blue-800" %>
  </div>
  
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Supplier Performance</h1>
  
  <!-- Performance Overview -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-white shadow rounded-lg p-6">
      <p class="text-sm font-medium text-gray-500">Total Suppliers</p>
      <p class="text-2xl font-bold text-gray-900"><%= @suppliers.count %></p>
    </div>
    <div class="bg-white shadow rounded-lg p-6">
      <p class="text-sm font-medium text-gray-500">Avg Response Time</p>
      <p class="text-2xl font-bold text-gray-900"><%= (@response_times.values.compact.sum / @response_times.values.compact.size).round(1) rescue 0 %> hrs</p>
    </div>
    <div class="bg-white shadow rounded-lg p-6">
      <p class="text-sm font-medium text-gray-500">Best Win Rate</p>
      <p class="text-2xl font-bold text-green-600"><%= @win_rates.values.first || 0 %>%</p>
    </div>
  </div>
  
  <!-- Supplier Table -->
  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Supplier Metrics</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Supplier</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total Quotes</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RFQs Participated</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Avg Price</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Win Rate</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Avg Response Time</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @suppliers.each do |supplier| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= supplier.company_name %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= supplier.total_quotes %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= supplier.rfqs_participated %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                £<%= number_with_delimiter(supplier.avg_price.to_f.round(2)) %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span class="<%= @win_rates[supplier.company_name].to_f > 20 ? 'text-green-600 font-medium' : 'text-gray-500' %>">
                  <%= @win_rates[supplier.company_name] || 0 %>%
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= (@response_times[supplier.company_name] || 0).round(1) %> hrs
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Win Rate Chart -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Win Rates by Supplier</h2>
      <% if @win_rates.any? %>
        <%= bar_chart @win_rates.first(10), suffix: "%", height: "300px" %>
      <% else %>
        <p class="text-gray-500">No data available</p>
      <% end %>
    </div>
    
    <!-- Response Time Analysis -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Average Response Times</h2>
      <% if @response_times.any? %>
        <%= bar_chart @response_times.transform_values { |v| v&.round(1) }.compact.sort_by { |_, v| v }.first(10), 
            suffix: " hrs", height: "300px" %>
      <% else %>
        <p class="text-gray-500">No data available</p>
      <% end %>
    </div>
  </div>
</div>