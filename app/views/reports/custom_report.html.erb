<div class="max-w-7xl mx-auto">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Custom Report Builder</h1>
    <p class="mt-2 text-gray-600">Build your own custom reports by selecting metrics and dimensions</p>
  </div>

  <div class="bg-white shadow rounded-lg p-6 mb-8">
    <%= form_with url: custom_report_reports_path, method: :get, local: true, html: { class: "space-y-6" } do |f| %>
      
      <!-- Metrics Selection -->
      <div>
        <h3 class="text-lg font-medium text-gray-900 mb-3">Select Metrics</h3>
        <p class="text-sm text-gray-600 mb-4">Choose the metrics you want to include in your report</p>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <% @available_metrics.each do |metric| %>
            <label class="flex items-center space-x-3 cursor-pointer">
              <%= check_box_tag "metrics[]", metric, params[:metrics]&.include?(metric), 
                  class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
              <span class="text-sm text-gray-700"><%= metric %></span>
            </label>
          <% end %>
        </div>
      </div>

      <!-- Dimensions Selection -->
      <div class="border-t pt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Select Dimensions</h3>
        <p class="text-sm text-gray-600 mb-4">Choose how you want to group your data</p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <% @available_dimensions.each do |dimension| %>
            <label class="flex items-center space-x-3 cursor-pointer">
              <%= check_box_tag "dimensions[]", dimension, params[:dimensions]&.include?(dimension), 
                  class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
              <span class="text-sm text-gray-700"><%= dimension %></span>
            </label>
          <% end %>
        </div>
      </div>

      <!-- Date Range Filter -->
      <div class="border-t pt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Date Range</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= label_tag :start_date, "Start Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= date_field_tag "filters[start_date]", params.dig(:filters, :start_date) || 3.months.ago.to_date, 
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
          </div>
          <div>
            <%= label_tag :end_date, "End Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= date_field_tag "filters[end_date]", params.dig(:filters, :end_date) || Date.current, 
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="border-t pt-6">
        <%= submit_tag "Generate Report", 
            class: "w-full md:w-auto px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
      </div>
    <% end %>
  </div>

  <!-- Report Results -->
  <% if @report_data.present? %>
    <div class="bg-white shadow rounded-lg p-6">
      <div class="mb-6">
        <h2 class="text-xl font-semibold text-gray-900">Report Results</h2>
        <p class="mt-1 text-sm text-gray-600">
          Generated on <%= Date.current.strftime("%B %d, %Y") %> at <%= Time.current.strftime("%I:%M %p") %>
        </p>
      </div>

      <!-- Placeholder for actual report data -->
      <div class="bg-gray-50 rounded-lg p-8 text-center">
        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <p class="text-gray-600">Your custom report will appear here once generated.</p>
        <p class="text-sm text-gray-500 mt-2">
          Selected <%= params[:metrics]&.count || 0 %> metrics and <%= params[:dimensions]&.count || 0 %> dimensions
        </p>
      </div>

      <!-- Export Options -->
      <div class="mt-6 flex justify-end space-x-3">
        <button type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          <svg class="mr-2 -ml-1 h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Export CSV
        </button>
        <%= link_to custom_report_reports_path(format: :pdf, metrics: params[:metrics], dimensions: params[:dimensions], filters: params[:filters]), 
            class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" do %>
          <svg class="mr-2 -ml-1 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
          Export PDF
        <% end %>
      </div>
    </div>
  <% else %>
    <!-- Initial State -->
    <div class="bg-white shadow rounded-lg p-12 text-center">
      <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
      </svg>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No Report Generated</h3>
      <p class="text-gray-600">Select metrics and dimensions above to build your custom report</p>
    </div>
  <% end %>
</div>